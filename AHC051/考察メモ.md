# AHC051 考察メモ

## 問題の本質
- 確率的な分別器を組み合わせて、各ごみを正しい処理装置に導く確率を最大化
- 分別器は2分岐のみ → 複数段の分別で精度向上を図る必要がある
- ベルトコンベアの交差制約とDAG制約を満たしながら最適な経路を構築

## 重要な観察
### 1. 分別の基本戦略
- 1つの分別器で完全に分別することは不可能（確率的なため）
- 同じ分別器を複数回通すことで、特定のごみの純度を上げられる
- 異なる分別器を組み合わせることで、より細かい分類が可能

### 2. 確率の計算
- ごみiが処理装置jに到達する確率は、経路上の分別確率の積
- 複数経路がある場合は、各経路の確率の和
- 例：分別器を2段通る場合
  - 1段目で出口1(確率p1) → 2段目で出口1(確率p2) → 最終確率 p1×p2

### 3. グラフ構造の制約
- DAG（有向非循環グラフ）である必要 → トポロジカルソート可能
- ベルトコンベアの交差不可 → 平面グラフ的な制約
- これらの制約により、単純な木構造が有効な可能性

## アプローチ案

### アプローチ1: 決定木的構造
- 二分木のような構造で段階的に分別
- 各段階で最も効果的な分別器を選択
- メリット：シンプル、交差しにくい
- デメリット：分別回数が限られる

### アプローチ2: 特定ごみ専用ライン
- 分別確率が極端に高い組み合わせを見つける
- 特定のごみだけを高確率で分離するラインを構築
- 残りのごみは別ラインで処理

### アプローチ3: 多段フィルタリング
- 同じ分別器を複数回使用
- 徐々に純度を上げていく
- 最終的に高純度のごみを処理装置へ

## 実装方針

### Phase 1: 基本実装
1. 入力の読み込み
2. シンプルな木構造での分別実装
3. 確率計算とスコア算出
4. 出力形式の確認

### Phase 2: 最適化
1. 分別器の選択アルゴリズム
   - 各分別器の「分離度」を評価
   - エントロピーや情報利得で評価
2. 配置の最適化
   - ベルトコンベアが交差しない配置
   - 距離を考慮した配置

### Phase 3: 高度な最適化
1. 動的計画法での経路最適化
2. 焼きなまし法での全体構造の改善
3. ビームサーチでの段階的構築

## 評価指標の分析
- スコア = 10^9 × (1/N) × Σ(1-q[i])
- q[i]を1に近づけることが重要
- 全てのごみを均等に改善するより、改善しやすいものから確実に

## 実装上の注意点
1. 線分交差判定は提供された疑似コードを使用
2. 浮動小数点の精度に注意（確率計算）
3. DAG制約のチェック（トポロジカルソート可能性）
4. メモリと実行時間の制約（2秒、1024MB）

## デバッグ・可視化
- 構築したグラフ構造の可視化
- 各ごみの経路と到達確率の表示
- ベルトコンベアの交差チェック
- スコアの段階的な改善状況の記録